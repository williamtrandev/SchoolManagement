<div class="bg-light text-center rounded p-4">
	<div class="d-flex align-items-center mb-4">
		<label class="me-3" for="yearSelect">Chọn năm học:</label>
		<select class="form-select w-auto" id="yearSelect">
			<option value="none" disabled selected>Chọn</option>
			{{#each years}}
				<option value="{{_id}}">{{startYear}} - {{endYear}}</option>
			{{/each}}
		</select>
		<label class="ms-4 me-3" for="classSelect">Chọn lớp:</label>
		<select class="form-select w-auto" id="classSelect">
			{{!-- Class thì dùng fetch --}}
		</select>
		
	</div>
	<div class="table-responsive d-none">
		<table class="table text-start align-middle table-bordered mb-0 text-nowrap">
			<thead>
				<tr class="text-dark">
					<th>Mã học sinh</th>
					<th>Họ và tên</th>
					<th>Lớp</th>
					{{#each subjects}}
						<th>{{name}}</th>
					{{/each}}
					<th>ĐTB</th>

				</tr>
			</thead>
			<tbody>
				
			</tbody>
		</table>
	</div>
</div>

<script>
	$(function() {
		let yearSelected = null;
		let classSelected = null;
		$('#yearSelect').change(function() {
			let yearId = $(this).val();
			yearSelected = $(this).val();
			fetch(`/admin/getAllClassByYear/${yearId}`)
			.then(res => {
				if(!res.ok) throw new Error('Lỗi');
				return res.json();
			})
			.then(data => {
	
				let options = `<option value="none" disabled selected>Chọn</option>`;
				data.forEach(item => {
					options += `<option value="${item._id}">${item.name}</option>`;
				});
				$('#classSelect').empty().append(options);
			})
			.catch(err => {
				console.log(err);
			});
		});
		$('#classSelect').change(function() {
			classSelected = $(this).val();
			$('.table-responsive').removeClass('d-none');
			fetch(`/admin/getResult/${classSelected}`)
			.then(res => {
				if(!res.ok) throw new Error('Lỗi');
				return res.json();
			})
			.then(data => {
				console.log(data);
			})
			.catch(err => {
				console.log(err);
				toastr.error('Lỗi khi lấy dữ liệu');
			})
		});
		
	})
</script>