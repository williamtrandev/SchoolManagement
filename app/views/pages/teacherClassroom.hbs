<!-- Works Start -->
<div class="container-fluid pt-4 px-4">
    <div class="bg-primary text-center rounded p-4 mb-4 d-flex flex-column align-items-center justify-content-between">
        <h3 class="mb-2 text-light">Lớp: {{assignment.class.name}}</h3>
        <h6 class="mb-0 text-light">Môn: {{assignment.subject.name}}</h6>
    </div>

    <div class="announcement bg-light rounded p-4 mb-2">
        <button type="button" class="btn btn-primary m-2" id="newAnnouncementBtn" data-toggle="modal" data-target="#newAnnouncementModal">
            <i class="fa-solid fa-plus"></i>
            <i class="fa-solid fa-bell me-2"></i>
            Thông báo mới
        </button>
        <button type="button" class="btn btn-primary m-2" id="newExerciseBtn" data-toggle="modal" data-target="#newExerciseModal">
            <i class="fa-solid fa-plus"></i>
            <i class="fa-solid fa-pen me-2"></i>
            Bài tập mới
        </button>
    </div>

    <div class="classroom-container">
    {{#each combinedData}}
        {{#if message}}
            <div class="announcement bg-light rounded p-4 mb-2">
                <div class="d-flex work mb-4">
                    <i class="fa-solid fa-bell me-4"></i>
                    <div>
                        <div class="mb-2 fs-5 fw-bold text-dark">{{title}}</div>
                        <div class="mb-0 text-secondary">{{annoucementDateFormat createdAt}}</div>
                    </div>
                </div>
                <div class="line mt-4 mb-4"></div>
                <div class="d-flex text-secondary">
                    {{message}}
                </div>
            </div>
        {{else}}
            <div class="bg-light rounded p-4 mb-2">
                <div class="d-flex work">
                    <i class="fa-solid fa-pen me-4"></i>
                    <div>
                        <div class="mb-2 fs-5 fw-bold text-dark">{{title}}</div>
                        <div class="mb-2 text-secondary">{{annoucementDateFormat createdAt}}</div>
                        <div class="text-danger">Hạn nộp: {{annoucementDateFormat deadline}}</div>
                    </div>
                </div>
                <div class="line mt-4 mb-4"></div>
                <div class="d-flex justify-content-between">
                    <div class="text-break w-75">
                        <p class="">
                            {{description}}
                        </p>
                    </div>
                    {{!-- <div class="w-25 ms-4">
                        {{#if submission}}
                        <div id="exercise{{_id}}" class="mb-2">
                            {{#each submission.imagePath}}
                            <div class="btn bg-warning rounded-pill">{{this}}</div>
                            {{/each}}
                        </div>
                        <button type="button" class="unsubmit-btn btn btn-danger w-100" data-toggle="modal" data-target="#unsubmitModal"
                            data-title="{{title}}"
                            data-id="{{_id}}"
                        >
                            Hủy nộp bài
                        </button>
                        {{else}}
                        <div id="exercise{{_id}}" class="mb-2">
                            <div>Chưa nộp</div>
                        </div>
                        <button type="button" class="submit-btn btn btn-primary w-100" data-toggle="modal" data-target="#submitModal"
                            data-title="{{title}}"
                            data-id="{{_id}}"
                        >
                            Nộp bài
                        </button>
                        {{/if}}
                    </div> --}}
                </div>
            </div>
        {{/if}}
    {{/each}}
    </div>
    
</div>
<!-- Works End -->

<!-- New Announcement Modal -->
<div class="modal fade" id="newAnnouncementModal" tabindex="-1" aria-labelledby="newAnnouncementModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="newAnnouncementModalLabel">Thông báo mới</h5>
                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="newAnnouncementForm">
                    <div class="mb-3">
                        <label for="announcementTitle" class="form-label">Tiêu đề</label>
                        <input type="text" class="form-control" id="announcementTitle">
                    </div>
                    
                    <div class="mb-3">
                        <label for="announcementMessage" class="form-label">Nội dung</label>
                        <textarea class="form-control" id="announcementMessage" rows="4"></textarea>
                    </div>
                </form>
                

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="saveNewAnnouncement">Lưu</button>
            </div>
        </div>
    </div>
</div>

<!-- New Exercise Modal -->
<div class="modal fade" id="newExerciseModal" tabindex="-1" aria-labelledby="newExerciseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="newExerciseModalLabel">Bài tập mới</h5>
                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <div class="mb-3">
                    <label for="exerciseTitle" class="form-label">Tiêu đề</label>
                    <input type="text" class="form-control" id="exerciseTitle">
                </div>

                <div class="mb-3">
                    <label for="exerciseDeadline" class="form-label">Hạn nộp</label>
                    <input type="datetime-local" class="form-control" id="exerciseDeadline">
                </div>
                
                <div class="mb-3">
                    <label for="exerciseDescription" class="form-label">Nội dung</label>
                    <textarea class="form-control" id="exerciseDescription" rows="4"></textarea>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="saveNewExercise">Lưu</button>
            </div>
        </div>
    </div>
</div>

<script>
    $('#saveNewAnnouncement').click(function () {
        let assignmentId = '{{assignment._id}}';
        let title = $('#announcementTitle').val();
        let message = $('#announcementMessage').val();
        if (title == '') {
            toastr.error("Tiêu đề không được để trống");
            return;
        }
        if (message == '') {
            toastr.error("Nội dung không được để trống");
            return;
        }
        let data = {
            title,
            message,
            assignmentId,
        };
        fetch('/teacher/announcement/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(res => res.json())
        .then(data => {
            if (data.error) {
                toastr.error(data.error);
            } else {
                let newAnnouncement = "";
                let announcement = data.success;
                let createdAt = annoucementDateFormat(announcement.createdAt)
                newAnnouncement += `
                    <div class="announcement bg-light rounded p-4 mb-2">
                        <div class="d-flex work mb-4">
                            <i class="fa-solid fa-bell me-4"></i>
                            <div>
                                <div class="mb-2 fs-5 fw-bold text-dark">${announcement.title}</div>
                                <div class="mb-0 text-secondary">${createdAt}</div>
                            </div>
                        </div>
                        <div class="line mt-4 mb-4"></div>
                        <div class="d-flex text-secondary">
                            ${announcement.message}
                        </div>
                    </div>
                `;
                $('.classroom-container').prepend(newAnnouncement);
                $('#newAnnouncementModal').modal('hide');
                $('#newAnnouncementForm')[0].reset();
            }
        })
        .catch(err => {
            console.log(err);
        });
    });
</script>
